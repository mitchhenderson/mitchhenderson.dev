---
title: "How many wins do NRL teams need to make the finals?"
description: |
  It depends, but we can get a pretty good idea with monte carlo simulations
author: Mitch Henderson
date: 2025-01-18
draft: true
format: 
  code-fold: true
  code-tools: true
---

It's pretty common for sports teams to set themselves a goal at the start of a season to make the finals/playoffs . Teams in the NRL[^1] are no different. The flaw in this goal though, is that the number of wins needed to qualify for the finals varies from season-to-season depending on the results of other teams. A 13-win season (out of 24) is enough to qualify some years, but not enough in others. So how many wins do teams need to be confident they'll qualify?

[^1]: National Rugby League

We can calculate the probability of a team making the finals based on how many games they won in a few ways.

```{r}
#| output: false

# Setup
library(tidyverse)
library(furrr)
library(parallel)
library(igraph)
library(ggdist)
library(data.table)
library(ggtext)
library(gt)

colours <- c("#E31937", "#134A8E")

socials <- mitchhenderson::social_caption(icon_colour = "dodgerblue")

theme_set(theme_minimal() +
            theme(text = element_text(family = "Myriad Pro"),
                  plot.caption = element_markdown(),
                  plot.title = element_markdown(size = 18),
                  plot.subtitle = element_markdown(),
                  plot.title.position = "plot",
                  panel.grid.minor = element_blank()))
```

I scraped 10 seasons of match result data from Wikipedia (excluding shortened 2020 season).

```{r}
#| output: false

# Import match results for 10 seasons (up to 2024)
import <- read_csv("https://raw.githubusercontent.com/mitchhenderson/mitchhenderson.dev/refs/heads/main/posts/_2025-01-18-how-many-wins-do-nrl-teams-need-to-make-the-finals/2014-2024_nrl_match_results.csv")
```

```{r}
DT::datatable(import)
```

I calculated the points differential for each match and created binary (0 or 1) indicator columns for the winning/losing team and draws. The distribution of points differentials is *interesting*.

```{r}
data <- import |>
  mutate(points_differential = home_score - away_score,
         home_win = if_else(points_differential > 0, 1, 0),
         away_win = if_else(points_differential < 0, 1, 0),
         draw = if_else(points_differential == 0, 1, 0))

average_10yr_points_diff <- data |>
  pull(points_differential) |> 
  mean()

data |>
  ggplot(aes(x = points_differential)) +
  geom_histogram(binwidth = 1, colour = "white", fill = colours[2]) +
  labs(y = "Number of games", x = "Points differential",
       title = "**Most games end with an even  points differential**",
       subtitle = "This makes sense given tries (4) and goals (2) are by far the most common ways to score points",
       caption = socials) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
  annotate("segment", 
           y = 0, 
           yend = 105, 
           x = average_10yr_points_diff, 
           xend = average_10yr_points_diff, 
           linetype = "dashed",
           colour = "grey50") +
  geom_richtext(data = tibble(y = 100, 
                              x = average_10yr_points_diff,
                              label = glue::glue("**{scales::number(average_10yr_points_diff, accuracy = 0.1)} points**<br>Home team advantage over past 10 years<br>(i.e. average points differential)")),
                aes(x, y, label = label),
                hjust = 0, fill = NA, label.color = NA, size = 2.5, colour = "grey40") +
  theme(panel.grid.major.x = element_blank(),
        axis.line.x = element_line(colour = "grey20"))
```
